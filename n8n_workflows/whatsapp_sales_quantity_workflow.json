{
    "name": "WhatsApp SatÄ±ÅŸ MiktarÄ± Sorgulama",
    "nodes": [
        {
            "parameters": {
                "url": "https://satis.gemas.com.tr/api/urun/get_product_sales_summary.php",
                "sendQuery": true,
                "queryParameters": {
                    "parameters": [
                        {
                            "name": "code",
                            "value": "={{ ($json.body?.data?.message?.conversation || $json.body?.data?.message?.extendedTextMessage?.text || '').toLowerCase().split(' ')[1] || '' }}"
                        },
                        {
                            "name": "token",
                            "value": "gemas_secret_n8n_token_2025"
                        }
                    ]
                },
                "options": {}
            },
            "id": "sales-api-request",
            "name": "SatÄ±ÅŸ MiktarÄ± Sorgula",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                -3088,
                3088
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": false,
                        "typeValidation": "strict",
                        "version": 2
                    },
                    "conditions": [
                        {
                            "id": "id-1",
                            "leftValue": "={{ $json.found }}",
                            "operator": {
                                "type": "boolean",
                                "operation": "true"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "sales-found-check",
            "name": "SatÄ±ÅŸ Verisi Bulundu mu?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
                -2864,
                3088
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://wp.gemas.com.tr/message/sendText/gemaswp",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "CA978DEA6B1C-4A5E-8E76-3534B9B6F1F3"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"number\": \"{{ $('teklifOnayCevap4').item.json.body.data.key.remoteJid }}\",\n  \"text\": \"ğŸ“Š *SatÄ±ÅŸ MiktarÄ± Raporu*\\n\\n*Stok Kodu:* {{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.stock_code }}\\n\\n*ğŸ“ˆ Ã–zet Bilgiler*\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nToplam SatÄ±ÅŸ: {{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.summary.total_quantity }} Adet\\nToplam Fatura: {{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.summary.total_invoices }} Adet\\nYÄ±llÄ±k Ortalama: {{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.summary.avg_yearly_quantity }} Adet\\n\\n*ğŸ† En Ä°yi YÄ±l*\\n{{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.summary.best_year }}: {{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.summary.best_year_quantity }} Adet\\n\\n*ğŸ“… YÄ±llara GÃ¶re DaÄŸÄ±lÄ±m*\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n{{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.yearly_breakdown.map(y => `${y.year}: ${y.quantity} Adet (${y.invoices} Fatura)`).join('\\\\n') }}\\n\\n_DÃ¶nem: {{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.period.start_year }}-{{ $('SatÄ±ÅŸ MiktarÄ± Sorgula').item.json.period.end_year }}_\"\n}",
                "options": {}
            },
            "id": "sales-send-success",
            "name": "SatÄ±ÅŸ Bilgisi GÃ¶nder",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                -2640,
                2992
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://wp.gemas.com.tr/message/sendText/gemaswp",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "CA978DEA6B1C-4A5E-8E76-3534B9B6F1F3"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"number\": \"{{ $('teklifOnayCevap4').item.json.body.data.key.remoteJid }}\",\n  \"text\": \"âŒ *SatÄ±ÅŸ Verisi BulunamadÄ±*\\n\\nGirdiÄŸiniz stok kodu iÃ§in satÄ±ÅŸ verisi bulunamadÄ±.\\n\\nMuhtemel sebepler:\\nâ€¢ Stok kodu hatalÄ±\\nâ€¢ Bu Ã¼rÃ¼nden hiÃ§ satÄ±ÅŸ yapÄ±lmamÄ±ÅŸ\\nâ€¢ ÃœrÃ¼n son 3 yÄ±lda kayÄ±tlÄ± deÄŸil\\n\\nLÃ¼tfen stok kodunu kontrol edip tekrar deneyin.\"\n}",
                "options": {}
            },
            "id": "sales-send-notfound",
            "name": "SatÄ±ÅŸ BulunamadÄ± MesajÄ±",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                -2640,
                3184
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "{\n  \"status\": \"ok\"\n}",
                "options": {
                    "responseCode": 200
                }
            },
            "id": "sales-webhook-response",
            "name": "Webhook YanÄ±tÄ± (SatÄ±ÅŸ)",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.4,
            "position": [
                -2416,
                2992
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": false,
                        "typeValidation": "strict",
                        "version": 2
                    },
                    "conditions": [
                        {
                            "id": "sales-trigger-1",
                            "leftValue": "={{ \n  (\n    $('teklifOnayCevap4').item.json.body?.data?.message?.conversation\n    || $('teklifOnayCevap4').item.json.body?.data?.message?.extendedTextMessage?.text\n    || ''\n  ).toLowerCase()\n}}",
                            "rightValue": "",
                            "operator": {
                                "type": "string",
                                "operation": "regex",
                                "singleValue": "sati(s|ÅŸ)"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "sales-format-check",
            "name": "SatÄ±ÅŸ MesajÄ± mÄ±?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
                -3360,
                3104
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://wp.gemas.com.tr/message/sendText/gemaswp",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "CA978DEA6B1C-4A5E-8E76-3534B9B6F1F3"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"number\": \"{{ $('WhatsApp Mesaj Webhook').item.json.body.data.key.remoteJid }}\",\n  \"text\": \"ğŸ“Š *SatÄ±ÅŸ MiktarÄ± Sorgulama*\\n\\nLÃ¼tfen Ã¼rÃ¼nÃ¼n stok kodunu aÅŸaÄŸÄ±daki formatta girin:\\n\\n*satÄ±ÅŸ STOKKODU*\\nveya\\n*satis STOKKODU*\\n\\nÃ–rnek:\\nsatÄ±ÅŸ 0111300N\\nsatis 0111300N\"\n}",
                "options": {}
            },
            "id": "sales-help-message",
            "name": "SatÄ±ÅŸ Stok Kodu Ä°ste",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                -2640,
                2800
            ]
        }
    ],
    "connections": {
        "SatÄ±ÅŸ MiktarÄ± Sorgula": {
            "main": [
                [
                    {
                        "node": "SatÄ±ÅŸ Verisi Bulundu mu?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "SatÄ±ÅŸ Verisi Bulundu mu?": {
            "main": [
                [
                    {
                        "node": "SatÄ±ÅŸ Bilgisi GÃ¶nder",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "SatÄ±ÅŸ BulunamadÄ± MesajÄ±",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "SatÄ±ÅŸ Bilgisi GÃ¶nder": {
            "main": [
                [
                    {
                        "node": "Webhook YanÄ±tÄ± (SatÄ±ÅŸ)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "SatÄ±ÅŸ BulunamadÄ± MesajÄ±": {
            "main": [
                [
                    {
                        "node": "Webhook YanÄ±tÄ± (SatÄ±ÅŸ)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "SatÄ±ÅŸ MesajÄ± mÄ±?": {
            "main": [
                [
                    {
                        "node": "SatÄ±ÅŸ MiktarÄ± Sorgula",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "SatÄ±ÅŸ Stok Kodu Ä°ste",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "SatÄ±ÅŸ Stok Kodu Ä°ste": {
            "main": [
                [
                    {
                        "node": "Webhook YanÄ±tÄ± (SatÄ±ÅŸ)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "pinData": {},
    "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "80d21026f61d88fdec67dcb4d4141f25eaaa6c50023c0c5bf1a07c75f29233c7"
    }
}